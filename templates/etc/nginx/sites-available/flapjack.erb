server {
  listen                  <%= server_name %>:80;
  server_name             <%= server_name %>;
  access_log              /var/log/nginx/<%= short_name %>-access.log;
  error_log               /var/log/nginx/<%= short_name %>-error.log;
  server_name_in_redirect off;
  server_tokens           off;

  # Normalise Accept-Encoding header for later reuse.
  if ($http_accept_encoding ~ gzip){
    set $encoding "gzip";
    break;
  }
  if ($http_accept_encoding ~ deflate){
    set $encoding "deflate";
    break;
  }

  location / {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;

    #error_page 500 502 503 504 /500.html;
    proxy_pass http://<%= application_servers %>;
  }
}
